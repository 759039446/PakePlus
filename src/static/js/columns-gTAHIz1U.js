var N=Object.defineProperty,Z=Object.defineProperties;var q=Object.getOwnPropertyDescriptors;var Y=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var M=(a,l,r)=>l in a?N(a,l,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[l]=r,D=(a,l)=>{for(var r in l||(l={}))$.call(l,r)&&M(a,r,l[r]);if(Y)for(var r of Y(l))A.call(l,r)&&M(a,r,l[r]);return a},w=(a,l)=>Z(a,q(l));var u=(a,l,r)=>new Promise((g,v)=>{var _=i=>{try{y(r.next(i))}catch(t){v(t)}},k=i=>{try{y(r.throw(i))}catch(t){v(t)}},y=i=>i.done?g(i.value):Promise.resolve(i.value).then(_,k);y((r=r.apply(a,l)).next())});import{b as x,d as U,u as W,c as j}from"./task-CFUYvxkY.js";import{u as S}from"./hooks-DRhJW1zI.js";import{d as G,a as J}from"./edit-pen-BOgRmhwF.js";import{n as p,t as K,x as Q,b as c,r as b,f as z,aC as m,b1 as X}from"./index-CvraN8U6.js";const ee={width:1024,height:1024,body:'<path fill="currentColor" d="M512 160c320 0 512 352 512 352S832 864 512 864S0 512 0 512s192-352 512-352zm0 64c-225.28 0-384.128 208.064-436.8 288c52.608 79.872 211.456 288 436.8 288c225.28 0 384.128-208.064 436.8-288c-52.608-79.872-211.456-288-436.8-288zm0 64a224 224 0 1 1 0 448a224 224 0 0 1 0-448zm0 64a160.192 160.192 0 0 0-160 160c0 88.192 71.744 160 160 160s160-71.808 160-160s-71.744-160-160-160z"/>'};function se(){const a=p({}),l=p(!0),r=p([]),g=p("编辑"),v=p(!1),_=p(""),k=[{label:"名称",prop:"name",valueType:"input"},{label:"类型",prop:"type",valueType:"select",options:[{label:"夸克分享数据提取",value:"夸克分享数据提取"},{label:"百度分享数据提取",value:"百度分享数据提取"},{label:"夸克登录",value:"夸克登录"},{label:"百度登录",value:"百度登录"}]},{label:"状态",prop:"status",valueType:"select",options:[{label:"待执行",value:"pending"},{label:"执行中",value:"running"},{label:"已完成",value:"completed"},{label:"失败",value:"failed"}]},{label:"开始时间范围",prop:"start_time",valueType:"date-picker",fieldProps:{type:"datetimerange",valueFormat:"YYYY-MM-DDTHH:mm:ssZ",rangeSeparator:"至",startPlaceholder:"开始时间",endPlaceholder:"结束时间"}},{label:"结束时间范围",prop:"end_time",valueType:"date-picker",fieldProps:{type:"datetimerange",valueFormat:"YYYY-MM-DDTHH:mm:ssZ",rangeSeparator:"至",startPlaceholder:"开始时间",endPlaceholder:"结束时间"}}],y=[{label:"名称",prop:"name",valueType:"input",rules:[{required:!0,message:"请输入任务名称"}]},{label:"类型",prop:"type",valueType:"select",options:[{label:"夸克分享数据提取",value:"夸克分享数据提取"},{label:"百度分享数据提取",value:"百度分享数据提取"},{label:"夸克登录",value:"夸克登录"},{label:"百度登录",value:"百度登录"}],rules:[{required:!0,message:"请选择任务类型"}]},{label:"关联参数",prop:"params",valueType:"textarea",fieldProps:{rows:4,placeholder:"请输入关联参数"}},{label:"状态",prop:"status",valueType:"select",options:[{label:"待执行",value:"pending"},{label:"执行中",value:"running"},{label:"已完成",value:"completed"},{label:"失败",value:"failed"}],rules:[{required:!0,message:"请选择任务状态"}]},{label:"执行结果",prop:"result",valueType:"textarea"},{label:"备注信息",prop:"remark",valueType:"textarea"},{label:"开始时间",prop:"start_time",valueType:"date-picker",fieldProps:{type:"datetime",valueFormat:"YYYY-MM-DDTHH:mm:ssZ"}},{label:"结束时间",prop:"end_time",valueType:"date-picker",fieldProps:{type:"datetime",valueFormat:"YYYY-MM-DDTHH:mm:ssZ"}}],i=p(!1),t=p({}),H=p([{label:"名称",prop:"name"},{label:"类型",prop:"type",cellRenderer:({row:e})=>c(b("el-tag"),{type:"primary"},{default:()=>[e.type]})},{label:"关联参数",prop:"params"},{label:"状态",prop:"status",cellRenderer:({row:e})=>{const o={pending:{type:"info",label:"待执行"},running:{type:"warning",label:"执行中"},completed:{type:"success",label:"已完成"},failed:{type:"danger",label:"失败"}}[e.status]||{type:"info",label:e.status};return c(b("el-tag"),{type:o.type},{default:()=>[o.label]})}},{label:"执行结果",prop:"result"},{label:"备注信息",prop:"remark"},{label:"开始时间",prop:"start_time",cellRenderer:({row:e})=>e.start_time?new Date(e.start_time).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/\//g,"-"):"-"},{label:"结束时间",prop:"end_time",cellRenderer:({row:e})=>e.end_time?new Date(e.end_time).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/\//g,"-"):"-"},{align:"center",label:"操作",prop:"operation",cellRenderer:({row:e})=>{const o=(e.type==="夸克登录"||e.type==="百度登录")&&e.status==="running"&&e.params;return c("div",null,[o&&c(b("el-button"),{link:!0,icon:S(ee),type:"primary",onClick:()=>B(e)},{default:()=>[z("查看")]}),c(b("el-button"),{link:!0,icon:S(G),type:"primary",onClick:()=>F(e)},{default:()=>[z("编辑")]}),c(b("el-button"),{link:!0,icon:S(J),type:"danger",onClick:()=>I(e)},{default:()=>[z("删除")]})])}}]),n=K({pageSize:10,currentPage:1,pageSizes:[10,15,20],total:0,align:"right",background:!0,size:"default"}),P=()=>u(this,null,function*(){l.value=!0;try{const e={page:n.currentPage,pageSize:n.pageSize,name:a.value.name,type:a.value.type,status:a.value.status,result:a.value.result};a.value.start_time&&(e.start_time_ge=a.value.start_time[0],e.start_time_le=a.value.start_time[1]),a.value.end_time&&(e.end_time_ge=a.value.end_time[0],e.end_time_le=a.value.end_time[1]);const s=yield x(e);s.code===200&&(r.value=s.data,n.total=s.total)}catch(e){console.error("查询任务失败:",e)}finally{l.value=!1}}),R=()=>u(this,null,function*(){a.value={},n.currentPage=1,yield f(n.currentPage,n.pageSize)});function V(){return u(this,null,function*(){g.value="添加",t.value={name:"",type:"",params:"",status:"pending",result:"",remark:"",start_time:"",end_time:""},i.value=!0})}function f(e,s,o){return u(this,null,function*(){var d,C;l.value=!0;try{const h=D({page:e,pageSize:s},o),T=yield x(h);T.code===200?(r.value=T.data,n.total=T.total):m.error(T.message||"获取数据失败")}catch(h){console.error("请求错误:",h),m.error(((C=(d=h.response)==null?void 0:d.data)==null?void 0:C.message)||"获取数据失败")}finally{l.value=!1}})}function F(e){return u(this,null,function*(){g.value="编辑";const s=w(D({},e),{start_time:e.start_time?new Date(e.start_time).toISOString():void 0,end_time:e.end_time?new Date(e.end_time).toISOString():void 0});t.value=s,i.value=!0})}function I(e){return u(this,null,function*(){X.confirm("删除后不可恢复，是否确定删除?","Warning",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>u(this,null,function*(){var s,o;try{const d=yield U({id:e.id});d.code===200?(m({type:"success",message:d.message||"删除成功"}),yield f(n.currentPage,n.pageSize)):m({type:"error",message:d.message||"删除失败"})}catch(d){m({type:"error",message:((o=(s=d.response)==null?void 0:s.data)==null?void 0:o.message)||"删除失败"})}}))})}function B(e){_.value=e.params,v.value=!0}function O(e){n.pageSize=e,f(n.currentPage,n.pageSize)}function E(e){return u(this,null,function*(){n.currentPage=e,yield f(n.currentPage,n.pageSize)})}function L(){return u(this,null,function*(){if(t.value)try{const e={name:t.value.name,type:t.value.type,status:t.value.status,params:t.value.params,result:t.value.result,remark:t.value.remark,start_time:t.value.start_time?new Date(t.value.start_time).toISOString():void 0,end_time:t.value.end_time?new Date(t.value.end_time).toISOString():void 0};t.value.id&&(e.id=t.value.id),(yield t.value.id?W(e):j(e)).code===200&&(m.success(t.value.id?"更新成功":"添加成功"),i.value=!1,P())}catch(e){console.error(t.value.id?"更新任务失败:":"添加任务失败:",e)}})}return Q(()=>{f(n.currentPage,n.pageSize)}),{loading:l,columns:H,pageData:r,pagination:n,editVisible:i,editValues:t,editColumns:y,searchColumns:k,editTitle:g,searchCondition:a,previewVisible:v,previewImageUrl:_,onSizeChange:O,onCurrentChange:E,handleSearch:P,handleOpenAddDialog:V,handleConfirm:L,handleRest:R,useRenderIcon:S}}export{se as useColumns};
